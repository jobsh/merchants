<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.merchant.system.mapper.ContractMapper">
    
    <resultMap type="Contract" id="ContractResult">
        <result property="id"    column="id"    />
        <result property="pid"    column="pid"    />
        <result property="rootNum"    column="root_num"    />
        <result property="num"    column="num"    />
        <result property="customerName"    column="customer_name"    />
        <result property="customerId"    column="customer_id"    />
        <result property="customerNum"    column="customer_num"    />
        <result property="customerPhone"    column="customer_phone"    />
        <result property="type"    column="type"    />
        <result property="produce"    column="produce"    />
        <result property="dianmianName"    column="dianmian_name"    />
        <result property="dianmianNum"    column="dianmian_num"    />
        <result property="dianmianProvince"    column="dianmian_province"    />
        <result property="dianmianCity"    column="dianmian_city"    />
        <result property="dianmianDistrict"    column="dianmian_district"    />
        <result property="dianmianAddress"    column="dianmian_address"    />
        <result property="dianmianLongitude"    column="dianmian_longitude"    />
        <result property="dianmianLatitude"    column="dianmian_latitude"    />
        <result property="guarantee"    column="guarantee"    />
        <result property="fee"    column="fee"    />
        <result property="operation"    column="operation"    />
        <result property="managerId"    column="manager_id"    />
        <result property="manager"    column="manager"    />
        <result property="signDate"    column="sign_date"    />
        <result property="signUserId"    column="sign_user_id"    />
        <result property="signUser"    column="sign_user"    />
        <result property="beginDate"    column="begin_date"    />
        <result property="endDate"    column="end_date"    />
        <result property="terminateDate"    column="terminate_date"    />
        <result property="status"    column="status"    />
        <result property="checkStatus"    column="check_status"    />
        <result property="file"    column="file"    />
        <result property="create_by"    column="createBy"    />
        <result property="remark"    column="remark"    />
    </resultMap>

    <sql id="selectContractVo">
        select id, pid, root_num, num, customer_name, customer_id, customer_num, customer_phone, type, produce,
        dianmian_name, dianmian_num, dianmian_province, dianmian_city, dianmian_district, dianmian_address,dianmian_longitude,dianmian_latitude,
        guarantee, fee, operation, manager_id, manager, sign_date, sign_user_id,
        sign_user, begin_date, end_date,terminate_date, status, check_status, create_by, remark, file from biz_contract
    </sql>

    <select id="selectContractList" parameterType="ContractBO" resultMap="ContractResult">
        <include refid="selectContractVo"/>
        <where>  
            <if test="num != null  and num != ''"> and num = #{num}</if>
            <if test="customerName != null  and customerName != ''"> and customer_name like concat('%', #{customerName}, '%')</if>
            <if test="customerPhone != null  and customerPhone != ''"> and customer_phone = #{customerPhone}</if>
            <if test="type != null  and type != ''"> and type = #{type}</if>
            <if test="produce != null  and produce != ''"> and produce = #{produce}</if>
            <if test="operation != null  and operation != ''"> and operation = #{operation}</if>
            <if test="signDateStart != null  and signDateStart != ''">and date_format(sign_date,'%y%m%d') &gt;= date_format(#{signDateStart},'%y%m%d')</if>
            <if test="signDateEnd != null  and signDateEnd != ''">and date_format(sign_date,'%y%m%d') &lt;= date_format(#{signDateEnd},'%y%m%d')</if>
            <if test="beginDateStart != null  and beginDateStart != ''">and date_format(begin_date,'%y%m%d') &gt;= date_format(#{beginDateStart},'%y%m%d')</if>
            <if test="beginDateEnd != null  and beginDateEnd != ''">and date_format(begin_date,'%y%m%d') &lt;= date_format(#{beginDateEnd},'%y%m%d')</if>
            <if test="checkDateStart != null  and checkDateStart != ''">and date_format(check_date,'%y%m%d') &gt;= date_format(#{checkDateStart},'%y%m%d')</if>
            <if test="checkDateEnd != null  and checkDateEnd != ''">and date_format(check_date,'%y%m%d') &lt;= date_format(#{checkDateEnd},'%y%m%d')</if>
            <if test="endDateStart != null  and endDateStart != ''">and date_format(end_date,'%y%m%d') &gt;= date_format(#{endDateStart},'%y%m%d')</if>
            <if test="endDateEnd != null  and endDateEnd != ''">and date_format(end_date,'%y%m%d') &lt;= date_format(#{endDateEnd},'%y%m%d')</if>
            <if test="status != null  and status != ''"> and status = #{status}</if>
            <if test="keywords != null and keywords != ''">and (
                instr(customerName, #{keywords}) +
                instr(customerPhone, #{keywords}) +
                instr(num, #{keywords})
                ) > 0</if>
            <!-- 数据范围过滤 -->
        </where>
    </select>

    <select id="selectContractById" parameterType="Integer" resultMap="ContractResult">
        <include refid="selectContractVo"/>
        where id = #{id}
    </select>

    <select id="selectContractByRootNum" parameterType="String" resultMap="ContractResult">
        <include refid="selectContractVo"/>
        where root_num = #{rootNum}
    </select>

    <select id="selectContractByNum" parameterType="String" resultMap="ContractResult">
        <include refid="selectContractVo"/>
        where num = #{num}
    </select>

    <select id="countContractByNum" parameterType="String" resultMap="ContractResult">
        <include refid="selectContractVo"/>
        where num = #{num}
    </select>

    <insert id="insertContract" parameterType="ContractBO" useGeneratedKeys="true" keyProperty="id">
        insert into biz_contract
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="num != null and num != ''">num,</if>
            <if test="rootNum != null and rootNum != ''">root_num,</if>
            <if test="customerName != null and customerName != ''">customer_name,</if>
            <if test="customerId != null">customer_id,</if>
            <if test="customerNum != null and customerNum != ''">customer_num,</if>
            <if test="customerPhone != null and customerPhone != ''">customer_phone,</if>
            <if test="type != null and type != ''">type,</if>
            <if test="produce != null and produce != ''">produce,</if>
            <if test="dianmianName != null and dianmianName != ''">dianmian_name,</if>
            <if test="dianmianNum != null and dianmianNum != ''">dianmian_num,</if>
            <if test="dianmianProvince != null and dianmianProvince != ''">dianmian_province,</if>
            <if test="dianmianCity != null and dianmianCity != ''">dianmian_city,</if>
            <if test="dianmianDistrict != null and dianmianDistrict != ''">dianmian_district,</if>
            <if test="dianmianAddress != null and dianmianAddress != ''">dianmian_address,</if>
            <if test="dianmianLongitude != null and dianmianLongitude != ''">dianmian_longitude,</if>
            <if test="dianmianLatitude != null and dianmianLatitude != ''">dianmian_latitude,</if>
            <if test="guarantee != null">guarantee,</if>
            <if test="fee != null and fee != ''">fee,</if>
            <if test="operation != null and operation != ''">operation,</if>
            <if test="managerId != null">manager_id,</if>
            <if test="manager != null and manager != ''">manager,</if>
            <if test="signDate != null">sign_date,</if>
            <if test="signUserId != null">sign_user_id,</if>
            <if test="signUser != null and signUser != ''">sign_user,</if>
            <if test="beginDate != null">begin_date,</if>
            <if test="endDate != null and endDate != ''">end_date,</if>
            <if test="status != null and status != ''">status,</if>
            <if test="createBy != null and createBy != ''">create_by,</if>
            <if test="remark != null and remark != ''">remark,</if>
            <if test="file != null and file != ''">file,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="num != null and num != ''">#{num},</if>
            <if test="rootNum != null and rootNum != ''">#{rootNum},</if>
            <if test="customerName != null and customerName != ''">#{customerName},</if>
            <if test="customerId != null">#{customerId},</if>
            <if test="customerNum != null and customerNum != ''">#{customerNum},</if>
            <if test="customerPhone != null and customerPhone != ''">#{customerPhone},</if>
            <if test="type != null and type != ''">#{type},</if>
            <if test="produce != null and produce != ''">#{produce},</if>
            <if test="dianmianName != null and dianmianName != ''">#{dianmianName},</if>
            <if test="dianmianNum != null and dianmianName != ''">#{dianmianNum},</if>
            <if test="dianmianProvince != null and dianmianProvince != ''">#{dianmianProvince},</if>
            <if test="dianmianCity != null and dianmianCity != ''">#{dianmianCity},</if>
            <if test="dianmianDistrict != null and dianmianDistrict != ''">#{dianmianDistrict},</if>
            <if test="dianmianAddress != null and dianmianAddress != ''">#{dianmianAddress},</if>
            <if test="dianmianLongitude != null and dianmianLongitude != ''">#{dianmianLongitude},</if>
            <if test="dianmianLatitude != null and dianmianLatitude != ''">#{dianmianLatitude},</if>
            <if test="guarantee != null">#{guarantee},</if>
            <if test="fee != null">#{fee},</if>
            <if test="operation != null and operation != ''">#{operation},</if>
            <if test="managerId != null">#{managerId},</if>
            <if test="manager != null and manager != ''">#{manager},</if>
            <if test="signDate != null">#{signDate},</if>
            <if test="signUserId != null">#{signUserId},</if>
            <if test="signUser != null and signUser != ''">#{signUser},</if>
            <if test="beginDate != null">#{beginDate},</if>
            <if test="endDate != null and endDate != ''">#{endDate},</if>
            <if test="status != null and status != ''">#{status},</if>
            <if test="createBy != null and createBy != ''">#{createBy},</if>
            <if test="remark != null and remark != ''">#{remark},</if>
            <if test="file != null and file != ''">#{file},</if>
         </trim>
    </insert>

    <update id="updateContract" parameterType="ContractBO">
        update biz_contract
        <trim prefix="SET" suffixOverrides=",">
            <if test="num != null and num != ''">num = #{num},</if>
            <if test="rootNum != null and rootNum != ''">root_num = #{rootNum},</if>
            <if test="customerName != null and customerName != ''">customer_name = #{customerName},</if>
            <if test="customerId != null">customer_id = #{customerId},</if>
            <if test="customerPhone != null and customerPhone != ''">customer_phone = #{customerPhone},</if>
            <if test="type != null and type != ''">type = #{type},</if>
            <if test="produce != null and produce != ''">produce = #{produce},</if>
            <if test="dianmianName != null and dianmianName != ''">dianmian_name = #{dianmianName},</if>
            <if test="dianmianNum != null">dianmian_num = #{dianmianNum},</if>
            <if test="dianmianProvince != null and dianmianProvince != ''">dianmian_province = #{dianmianProvince},</if>
            <if test="dianmianCity != null and dianmianCity != ''">dianmian_city = #{dianmianCity},</if>
            <if test="dianmianDistrict != null and dianmianDistrict != ''">dianmian_district = #{dianmianDistrict},</if>
            <if test="dianmianAddress != null and dianmianAddress != ''">dianmian_address = #{dianmianAddress},</if>
            <if test="dianmianLongitude != null and dianmianLongitude != ''">dianmian_longitude = #{dianmianLongitude},</if>
            <if test="dianmianLatitude != null and dianmianLatitude != ''">dianmian_latitude = #{dianmianLatitude},</if>
            <if test="guarantee != null">guarantee = #{guarantee},</if>
            <if test="fee != null">fee = #{fee},</if>
            <if test="operation != null and operation != ''">operation = #{operation},</if>
            <if test="managerId != null">manager_id = #{managerId},</if>
            <if test="manager != null and manager != ''">manager = #{manager},</if>
            <if test="signDate != null">sign_date = #{signDate},</if>
            <if test="signUserId != null">#{signUserId},</if>
            <if test="signUser != null and signUser != ''">sign_user = #{signUser},</if>
            <if test="checkStatus != null and checkStatus != ''">check_status = #{checkStatus},</if>
            <if test="beginDate != null">begin_date = #{beginDate},</if>
            <if test="endDate != null and endDate != ''">end_date = #{endDate},</if>
            <if test="terminateDate != null and terminateDate != ''">terminate_date = #{terminateDate},</if>
            <if test="status != null and status != ''">status = #{status},</if>
            <if test="createBy != null and createBy != ''">create_by = #{createBy},</if>
            <if test="remark != null and remark != ''">remark = #{remark},</if>
            <if test="file != null and file != ''">file = #{file},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteContractById" parameterType="Integer">
        delete from biz_contract where id = #{id}
    </delete>

    <delete id="deleteContractByIds" parameterType="String">
        delete from biz_contract where id in 
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
    
</mapper>